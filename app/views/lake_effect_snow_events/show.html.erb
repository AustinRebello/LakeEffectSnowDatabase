<p style="color: green"><%= notice %></p>

<%= render @lake_effect_snow_event %>

<script>
  const namBut = document.getElementById("nam");
  namBut.addEventListener("click", showData(1));

  const rapBut = document.getElementById("rap");
  rapBut.addEventListener("click", showData(2));

  const metBut = document.getElementById("met");
  metBut.addEventListener("click", showData(3));

  const snoBut = document.getElementById("sno");
  snoBut.addEventListener("click", showData(4));

  const allData = document.getElementById("data");
  window.addEventListener("load", showData(1))


  function showData(dataToShow){
    var nam = document.getElementById("NAM");
    var rap = document.getElementById("RAP");
    var met = document.getElementById("METARS");
    var sno = document.getElementById("SnowReports");

    nam.style.display = 'none';
    rap.style.display = 'none';
    met.style.display = 'none';
    sno.style.display = 'none';

    if(dataToShow == 1) {
        nam.style.display = 'block';
    } else if (dataToShow == 2){
        rap.style.display = 'block';
    } else if (dataToShow == 3){
        met.style.display = 'block';
    } else {
        sno.style.display = 'block'
    }
  }
</script>

<div class="p-1 text-center">
  <%= link_to "Back to all events", lake_effect_snow_events_path, class:"btn btn-secondary" %>
  <%= link_to "Edit", edit_lake_effect_snow_event_path(@lake_effect_snow_event), class:"btn btn-primary", data: { turbo_method: :get, turbo_confirm: 'This will delete all current BUFKIT and METARs data for this event. Are you sure you wish to edit?'} %>
  <%= button_to "Delete this event", @lake_effect_snow_event, method: :delete, class:"btn btn-danger", data: {turbo_method: :get, turbo_confirm: "This will permanently delete this event and all associated data. Are you sure you wish to delete?"} %>
</div>

<div class="p-1 text-center">
  <%= link_to 'Generate METAR data', python_metars_url(:event_id => @lake_effect_snow_event.id), class:"btn btn-success", data: { turbo_method: :get, turbo_confirm: 'This will delete all current METAR data for this event. Are you sure you wish to continue?'} %>
  <%= link_to 'Generate BUFKIT data', python_bufkits_url(:event_id => @lake_effect_snow_event.id), class:"btn btn-success", data: { turbo_method: :get, turbo_confirm: 'This will delete all current BUFKIT data for this event. Are you sure you wish to continue?'} %>
  <%= link_to 'Add Snow Report CSV file', file_snow_reports_url(:event_id => @lake_effect_snow_event.id), class:"btn btn-success", data: { turbo_method: :get, turbo_confirm: 'This will delete all snow reports for this event. Are you sure you wish to continue?'} %>
</div>

<div class="p-1 text-center">
  <%= link_to 'Delete METAR data', metar_lake_effect_snow_events_url(:id => @lake_effect_snow_event.id), class:"btn btn-danger", data: { turbo_method: :get, turbo_confirm: 'This will delete all current METAR data for this event. Are you sure you wish to continue?'} %>
  <%= link_to 'Delete BUFKIT data', bufkit_lake_effect_snow_events_url(:id => @lake_effect_snow_event.id), class:"btn btn-danger", data: { turbo_method: :get, turbo_confirm: 'This will delete all current BUFKIT data for this event. Are you sure you wish to continue?'} %>
  <%= link_to 'Delete Snow Reports', report_lake_effect_snow_events_url(:id => @lake_effect_snow_event.id), class:"btn btn-danger", data: { turbo_method: :get, turbo_confirm: 'This will delete all snow reports for this event. Are you sure you wish to continue?'} %>
</div>


<div id="tFields" class="pb-4">
  <ul class="nav nav-tabs nav-fill">
    <li class="nav-item">
      <%= button_tag  'NAM Data', id:"nam", class:"nav-link link-dark", :onclick => "showData(1)" %>
    </li>
    <li class="nav-item">
      <%= button_tag  'RAP Data', id:"rap", class:"nav-link link-dark", :onclick => "showData(2)" %>
    </li>
    <li class="nav-item">
      <%= button_tag  'METAR Data', id:"met", class:"nav-link link-dark", :onclick => "showData(3)" %>
    </li>
    <li class="nav-item">
      <%= button_tag  'Snow Report', id:"sno", class:"nav-link link-dark", :onclick => "showData(4)" %>
    </li>
  </ul>
</div>

<div id = "data">
  <div id="METARS" class="text-center container">
    <%= link_to "Export METAR Data", downloadCSV_metars_url(format: 'csv', event_id: @event.id) %>
    <table id = "namTable" class="table table-striped table-hover table-bordered">
      <thead class="thead-dark">
        <tr>
          <th scope="col">Site</th>
          <th scope="col">Observation Time</th>
          <th scope="col">Temperature</th>
          <th scope="col">Dew Point</th>
          <th scope="col">Humidity</th>
          <th scope="col">Wind Direction</th>
          <th scope="col">Wind Speed</th>
          <th scope="col">Mean Sea Level Pressure</th>
          <th scope="col">Vsibility</th>
          <th scope="col">Wind Gust</th>
          <th scope="col">Present Weather</th>
          <th scope="col">Peak Wind Gust</th>
          <th scope="col">Peak Wind Direction</th>
          <th scope="col">Peak Wind Time</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        <% @metar.each do |met| %>
          <tr>
              <% value = 1%>
              <% met.attributes.each do |attr_value| %>
                <% if (value != 1) && (value < 16) %>
                  <td><%= attr_value[1] %></td>
                <% end %>
                <% value = value + 1%>
              <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div id="SnowReports" class="text-center container">
    <%= link_to "Export Snow Report Data", downloadCSV_snow_reports_url(format: 'csv', event_id: @event.id) %>
    <table id = "snowTable"class="table table-striped table-hover table-bordered">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Last Name</th>
        <th scope="col">Town/City</th>
        <th scope="col">Latitude</th>
        <th scope="col">Longitude</th>
        <th scope="col">Storm Total</th>
      </tr>
    </thead>
    <tbody class="table-group-divider">
      <% @snow_reports.each do |report| %>
        <tr>
          <td><%=link_to report.lastName, report %></td>
          <td><%= report.city %></td>
          <td><%= report.latitude %></td>
          <td><%= report.longitude %></td>
          <td><%= report.stormTotal %></td>
       </tr>
      <% end %>
    </tbody>
    </table>
  </div>

  <div id="NAM" class="text-center container">
    <%= link_to "Export NAM Data", downloadCSV_bufkits_url(format: 'csv', modelType: "NAM", event_id: @event.id) %>
    <table id = "namTable" class="table table-striped table-hover table-bordered">
    <thead class="thead-dark">
      <tr>
        <% @tableHeaderBuf.each do |head| %>
          <th scope="col"><%= head %></th>
        <% end %>
      </tr>
    </thead>
    <tbody class="table-group-divider">
      <% @namBuf.each do |bufkit| %>
        <tr>
          <td><%= bufkit.modelType %></td>
          <td><%= bufkit.station %></td>
          <td><%= bufkit.month %>/<%= bufkit.day %>/<%= bufkit.year %> <%= bufkit.hour %>Z</td>
          <% value = 1 %>
          <% bufkit.attributes.each do |attr_value| %>
            <% if (value > 7) && (value < 40) %>
              <td><%= attr_value[1] %></td>
            <% end %>
            <% value = value + 1%>
          <% end %>
        </tr>
      <% end %>
    </tbody>
    </table>
  </div>

  <div id="RAP" class="text-center container">
    <%= link_to "Export RAP Data", downloadCSV_bufkits_url(format: 'csv', modelType: "RAP", event_id: @event.id) %>
    <table id = "rapTable" class="table table-striped table-hover table-bordered">
    <thead class="thead-dark">
      <tr>
        <% @tableHeaderBuf.each do |head| %>
          <th scope="col"><%= head %></th>
        <% end %>
      </tr>
    </thead>
    <tbody class="table-group-divider">
      <% @rapBuf.each do |bufkit| %>
        <tr>
          <td><%= bufkit.modelType %></td>
          <td><%= bufkit.station %></td>
          <td><%= bufkit.month %>/<%= bufkit.day %>/<%= bufkit.year %> <%= bufkit.hour %>Z</td>
          <% value = 1 %>
          <% bufkit.attributes.each do |attr_value| %>
            <% if (value > 7) && (value < 40) %>
              <td><%= attr_value[1] %></td>
            <% end %>
            <% value = value + 1%>
          <% end %>
        </tr>
      <% end %>
    </tbody>
    </table>
  </div>
</div>